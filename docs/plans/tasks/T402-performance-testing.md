# T402: Performance & Quality Testing

## 基本情報
- **タスクID**: T402
- **フェーズ**: Phase 4: Integration & Deployment
- **依存タスク**: T401 (E2E Testing)
- **成果物**:
  - パフォーマンスベンチマークレポート
  - メモリプロファイリングレポート
  - 画質検証レポート
  - アクセシビリティ監査レポート
- **推定時間**: 4-6時間

## 概要
パフォーマンス目標を検証し、メモリリーク、画質問題、アクセシビリティ問題を特定・修正します。

## パフォーマンス目標

| 指標 | 目標値 | 測定方法 |
|-----|--------|---------|
| アプリ起動時間 | < 2秒 | Xcode Instruments - Time Profiler |
| 生成レスポンス時間 (90th) | < 30秒 | 10回測定の90パーセンタイル |
| 画像保存時間 (4枚) | < 3秒 | Stopwatch計測 |
| メモリ使用量 (生成中) | < 200MB | Xcode Instruments - Allocations |
| アプリサイズ | < 50MB | Archive後のIPA確認 |

## テスト手順

### Test 1: アプリ起動時間

**手順**:
```bash
# Xcode Instruments使用
1. Xcode → Product → Profile
2. Time Profiler選択
3. Record開始
4. アプリ起動
5. ホーム画面が完全に表示されるまでの時間を測定
```

**測定**: ____秒 (目標: < 2秒)
**結果**: [ ] PASS / [ ] FAIL

---

### Test 2: 生成レスポンス時間

**手順**:
1. 同じ料理画像で10回生成を実行
2. 各回の開始→完了時間を記録
3. 90パーセンタイルを計算

**測定結果**:
| 回数 | 時間(秒) |
|-----|---------|
| 1   | ____ |
| 2   | ____ |
| 3   | ____ |
| 4   | ____ |
| 5   | ____ |
| 6   | ____ |
| 7   | ____ |
| 8   | ____ |
| 9   | ____ |
| 10  | ____ |

**90パーセンタイル**: ____秒 (目標: < 30秒)
**結果**: [ ] PASS / [ ] FAIL

---

### Test 3: 画像保存時間

**手順**:
1. 4枚の画像生成完了
2. 「全て保存する」タップ
3. ストップウォッチで測定
4. 保存完了メッセージまでの時間を記録

**測定**: ____秒 (目標: < 3秒)
**結果**: [ ] PASS / [ ] FAIL

---

### Test 4: メモリプロファイリング

**手順**:
```bash
# Xcode Instruments - Allocations
1. Xcode → Product → Profile → Allocations
2. Record開始
3. 10回連続で生成を実行
4. メモリ使用量を監視
5. メモリリークがないか確認
```

**確認項目**:
- [ ] 生成中のピークメモリ < 200MB
- [ ] 10回実行後もメモリが解放されている (メモリリークなし)
- [ ] Leaks Instrumentでリーク検出なし

**測定**:
- ピークメモリ: ____MB
- 10回実行後: ____MB

**結果**: [ ] PASS / [ ] FAIL

---

### Test 5: 画質検証

**手順**:
1. 以下のアスペクト比で各5枚生成
   - 4:5
   - 9:16
   - 16:9
   - 1:1
2. 各画像を目視確認

**確認項目**:
- [ ] 全アスペクト比で正しい寸法 (最長辺1080px)
- [ ] 料理が切り取られていない (no-crop確認)
- [ ] ぼかし背景が自然に見える
- [ ] JPEG品質が高い (ブロックノイズなし)
- [ ] 色再現性が良好

**サンプル画像保存先**: `docs/quality-samples/`

**結果**: [ ] PASS / [ ] FAIL

---

### Test 6: ネットワークプロファイリング

**手順**:
```bash
# Xcode → Debug → Network Link Conditioner
1. 3G回線をシミュレート
2. 生成を実行
3. タイムアウトせずに完了することを確認
```

**確認項目**:
- [ ] 3G回線でも生成が完了する (45秒タイムアウト内)
- [ ] リクエストペイロードが最適化されている (画像圧縮)
- [ ] 不要なリクエストがない

**結果**: [ ] PASS / [ ] FAIL

---

## アクセシビリティ監査

### VoiceOver対応確認

**手順**:
1. 設定 → アクセシビリティ → VoiceOver ON
2. 主要画面を操作
3. 全ての要素が読み上げられることを確認

**確認項目**:
- [ ] ボタンが適切にラベル付けされている
- [ ] 画像にaccessibilityLabel設定済み
- [ ] フォーカス順序が論理的
- [ ] モーダルが正しくフォーカスを取得

**改善が必要な箇所**: ________________

**結果**: [ ] PASS / [ ] FAIL

---

### Dynamic Type対応確認

**手順**:
1. 設定 → 画面表示と明るさ → テキストサイズ
2. 最大サイズに変更
3. アプリで全画面を確認

**確認項目**:
- [ ] テキストがサイズ変更に追従
- [ ] レイアウト崩れがない
- [ ] ボタンが押しやすいサイズを維持

**結果**: [ ] PASS / [ ] FAIL

---

### 色コントラスト確認

**手順**:
1. WCAG AA基準でコントラスト比を確認
2. ツール: https://contrast-ratio.com/

**確認項目**:
- [ ] テキスト/背景のコントラスト比 ≥ 4.5:1
- [ ] ボタンテキスト/ボタン背景のコントラスト比 ≥ 3:1
- [ ] 重要な情報が色だけで伝達されていない

**結果**: [ ] PASS / [ ] FAIL

---

## ローカライゼーション確認

**チェックリスト**:
- [ ] 全UI文字列が日本語
- [ ] ハードコードされた英語文字列なし
- [ ] 日付フォーマットが日本式 (YYYY年MM月DD日)
- [ ] 通貨表記が日本円 (¥)
- [ ] エラーメッセージが日本語
- [ ] プレースホルダーテキストが日本語

**検出された英語文字列**: ________________

**結果**: [ ] PASS / [ ] FAIL

---

## ビルドサイズ最適化

**手順**:
```bash
# Archive作成
cd bananadish-app
eas build --platform ios --profile production

# IPAサイズ確認
ls -lh *.ipa
```

**測定**:
- IPAサイズ: ____MB (目標: < 50MB)
- ダウンロードサイズ (App Store): ____MB

**最適化施策** (必要に応じて):
- [ ] 未使用アセット削除
- [ ] 画像圧縮
- [ ] 未使用ライブラリ削除
- [ ] Code Splittingconsider

**結果**: [ ] PASS / [ ] FAIL

---

## 完了条件（DoD）

- [ ] 全パフォーマンス目標を達成
- [ ] メモリリークなし
- [ ] 画質検証で全項目PASS
- [ ] VoiceOver基本対応完了
- [ ] Dynamic Type対応完了
- [ ] 色コントラストWCAG AA準拠
- [ ] 全UI文字列が日本語
- [ ] ビルドサイズ < 50MB

## 成果物

1. **パフォーマンスベンチマークレポート**: 全指標の測定結果
2. **メモリプロファイリングレポート**: Instruments出力結果
3. **画質検証レポート**: サンプル画像と評価結果
4. **アクセシビリティ監査レポート**: VoiceOver/Dynamic Type/コントラスト確認結果

## Notes

- **Instruments**: Xcodeの強力なプロファイリングツールを活用
- **実機テスト**: パフォーマンスは実機で測定 (シミュレーターは不正確)
- **継続監視**: リリース後もFirebase Performanceで監視継続
- **最適化**: 目標未達成の場合は最適化を実施してから再テスト

## 関連ドキュメント

- [実装計画書 - T402](/home/noritakasawada/project/20260117/docs/plans/bananadish-workplan.md#t402-performance--quality-testing)
- [Performance Requirements](/home/noritakasawada/project/20260117/docs/plans/bananadish-workplan.md#performance-requirements)
