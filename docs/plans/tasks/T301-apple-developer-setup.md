# T301: Apple Developer & App Store Connect Setup

## 基本情報
- **タスクID**: T301
- **フェーズ**: Phase 3: Payment Integration
- **依存タスク**: なし (Phase 2と並行実行可能)
- **成果物**:
  - App Store Connect登録済みアプリ
  - IAP製品設定 (Starter月額サブスクリプション、10回追加生成)
  - Sandbox テスターアカウント
  - App Store スクリーンショット準備 (プレースホルダー)
- **推定時間**: 2-3時間
- **費用**: Apple Developer Program年間費用 ¥12,800

## 概要
Apple Developer Programに登録し、App Store ConnectでBananaDishアプリを作成、In-App Purchase製品を設定します。Sandboxテスト環境の準備も含みます。

## 前提条件
- [ ] Apple IDアカウント保有
- [ ] クレジットカード/デビットカード (年会費支払い用)
- [ ] Apple Developer Program年間費用 ¥12,800 の支払い準備
- [ ] 法人の場合: D-U-N-S番号 (個人の場合は不要)

## 実装手順

### Step 1: Apple Developer Program登録

**初回登録の場合**:

1. **Apple Developer サイトにアクセス**:
   ```
   https://developer.apple.com/programs/
   ```

2. **「Enroll」をクリック**:
   - Apple IDでサインイン
   - 二要素認証を設定 (必須)

3. **エンティティタイプ選択**:
   - 個人開発者: "Individual / Sole Proprietor"
   - 法人: "Organization" (D-U-N-S番号が必要)

4. **個人情報入力**:
   - 氏名 (パスポートまたは運転免許証と一致する名前)
   - 住所
   - 電話番号
   - 開発者として公開される名前

5. **利用規約に同意**:
   - Apple Developer Program License Agreement を読んで同意

6. **年会費支払い**:
   - クレジットカード情報入力
   - ¥12,800 を支払い
   - 処理完了まで最大48時間

7. **承認待ち**:
   - メールで承認通知を受信 (通常24-48時間)
   - "Your enrollment is complete" メールを確認

**既に登録済みの場合**:
- Apple Developer アカウントにログインして有効期限を確認
- 有効期限切れの場合は更新 (¥12,800/年)

### Step 2: App Store Connect でアプリ作成

1. **App Store Connect にアクセス**:
   ```
   https://appstoreconnect.apple.com/
   ```

2. **「マイApp」→「+」→「新規App」**:
   - **プラットフォーム**: iOS
   - **名前**: BananaDish
   - **プライマリ言語**: 日本語
   - **バンドルID**: com.bananadish.app (Xcodeで作成済みのもの)
   - **SKU**: bananadish-ios-001 (一意の識別子)
   - **ユーザーアクセス**: フルアクセス

3. **App情報の基本設定**:
   - **カテゴリ**:
     - プライマリ: 写真/ビデオ
     - セカンダリ: フード&ドリンク
   - **コンテンツ権利**: 該当しない (広告なし)

4. **価格および配信状況**:
   - **価格**: 無料
   - **配信可能国**: 日本 (初期)
   - **App Store での配信**: はい

### Step 3: IAP製品の作成

#### 3-1: サブスクリプショングループ作成

1. **「機能」タブ → 「App内課金」→ 「+」**

2. **サブスクリプショングループ作成**:
   - **名前**: BananaDish Subscriptions
   - **参照名**: bananadish-subscription-group
   - **作成** をクリック

#### 3-2: Starterプラン月額サブスクリプション作成

1. **「自動更新サブスクリプション」を選択**

2. **製品情報**:
   - **参照名**: Starter Monthly Subscription
   - **製品ID**: `com.bananadish.starter.monthly`
     - 注意: 一度作成したら変更不可
   - **サブスクリプショングループ**: BananaDish Subscriptions

3. **サブスクリプション期間**:
   - **期間**: 1ヶ月

4. **サブスクリプション価格**:
   - **価格**: ¥1,980/月
   - **地域**: 日本 (JPY)
   - **価格帯**: Tier 20 (¥1,980相当)

5. **ローカリゼーション (日本語)**:
   - **サブスクリプション表示名**: Starterプラン
   - **説明**:
     ```
     月30回まで料理写真をプロ級に変換できます。
     - 毎月30枚の写真生成
     - 4種類のアスペクト比対応
     - 高品質JPEG出力
     - カメラロールに自動保存
     ```

6. **レビュー情報**:
   - **スクリーンショット**: 設定画面のサブスクリプション部分
   - **レビューノート**: "月額サブスクリプションで月30回の生成が可能"

7. **App Store プロモーション**:
   - **プロモーション画像**: 後で追加 (オプション)
   - **プロモーションテキスト**: "料理写真を一瞬でプロ級に"

8. **「保存」をクリック**

#### 3-3: 追加生成10回 (Consumable) 作成

1. **「+」→ 「消費型」を選択**

2. **製品情報**:
   - **参照名**: 10 Additional Generations
   - **製品ID**: `com.bananadish.addon.10gen`

3. **価格**:
   - **価格**: ¥980
   - **地域**: 日本 (JPY)
   - **価格帯**: Tier 10 (¥980相当)

4. **ローカリゼーション (日本語)**:
   - **表示名**: 追加生成 10回
   - **説明**:
     ```
     月間制限を超えた場合に追加で10回の生成が可能になります。
     - 即座に利用可能
     - 有効期限なし
     - 使い切るまで使用可能
     ```

5. **レビュー情報**:
   - **スクリーンショット**: 使用量超過時のモーダル画面
   - **レビューノート**: "月間制限を超えたユーザー向けの追加購入"

6. **「保存」をクリック**

### Step 4: Sandbox テスターアカウント作成

1. **App Store Connect → 「ユーザーとアクセス」**

2. **「Sandbox」タブ → 「+」**

3. **テスター情報入力**:
   - **名**: テスト
   - **姓**: ユーザー
   - **メールアドレス**: `bananadish.tester1@example.com` (実在しないメールでOK)
   - **パスワード**: 強力なパスワード (記録しておく)
   - **地域**: 日本

4. **複数のテスターを作成** (推奨):
   - テスター2: `bananadish.tester2@example.com`
   - テスター3: `bananadish.tester3@example.com`

5. **作成完了**

### Step 5: IAP製品のステータス確認

1. **「App内課金」画面で製品のステータス確認**:
   - ✅ **準備完了** (Ready to Submit): テスト可能
   - ⚠️ **メタデータが不足しています**: 必要情報を追加
   - ❌ **却下されました**: レビュー却下理由を確認

2. **「準備完了」ステータスになるまで情報を追加**

### Step 6: App Store スクリーンショット準備 (プレースホルダー)

**注意**: 実際のスクリーンショットはT403で作成します。ここではプレースホルダーを準備。

1. **必要なスクリーンショットサイズ**:
   - iPhone 6.7" (1290 x 2796 px) - iPhone 15 Pro Max
   - iPhone 6.5" (1242 x 2688 px) - iPhone 11 Pro Max
   - iPhone 5.5" (1242 x 2208 px) - iPhone 8 Plus

2. **最低限必要な枚数**: 各サイズ 3枚以上

3. **推奨する画面**:
   - スクリーンショット1: ホーム画面 (カメラ/ギャラリー選択)
   - スクリーンショット2: 生成中画面 (ローディング)
   - スクリーンショット3: 結果画面 (4枚のグリッド表示)
   - スクリーンショット4: 設定画面 (サブスクリプション情報)

4. **プレースホルダー作成**:
   - Figmaまたはスクリーンショットツールで仮画像を作成
   - 後でT403で実際のアプリスクリーンショットに差し替え

### Step 7: 税務情報と銀行口座情報の設定 (収益化準備)

1. **App Store Connect → 「契約、税金、および銀行情報」**

2. **有料Appの契約を有効化**:
   - 「リクエスト」をクリック
   - 利用規約に同意

3. **税務情報の入力**:
   - 個人: マイナンバーカード情報
   - 法人: 法人番号
   - 米国の税務フォーム (W-8BEN / W-9)

4. **銀行口座情報の入力**:
   - 銀行名
   - 口座番号
   - Swift/IBANコード (国際送金用)

5. **審査待ち** (最大5営業日)

## 完成コード

このタスクにコードはありません。設定のみです。

## 完了条件（DoD）

- [ ] Apple Developer Program登録完了 (年会費 ¥12,800 支払い済み)
- [ ] App Store Connect でアプリ "BananaDish" 作成済み
- [ ] バンドルID `com.bananadish.app` 登録済み
- [ ] IAP製品 `com.bananadish.starter.monthly` 作成済み (準備完了ステータス)
- [ ] IAP製品 `com.bananadish.addon.10gen` 作成済み (準備完了ステータス)
- [ ] サブスクリプション価格 ¥1,980/月 設定済み
- [ ] 追加生成価格 ¥980 設定済み
- [ ] Sandbox テスターアカウント 3つ作成済み
- [ ] プレースホルダースクリーンショット準備完了
- [ ] 税務情報と銀行口座情報入力済み (オプション、収益化時に必要)

## 検証手順

```bash
# App Store Connect での確認
# 1. https://appstoreconnect.apple.com/ にログイン
# 2. 「マイApp」→「BananaDish」を確認
# 3. 「App内課金」タブを開く
# 4. 2つの製品が「準備完了」ステータスであることを確認

# 製品ID確認:
# - com.bananadish.starter.monthly (自動更新サブスクリプション)
# - com.bananadish.addon.10gen (消費型)

# Sandbox テスター確認:
# 1. 「ユーザーとアクセス」→「Sandbox」タブ
# 2. 3つのテスターアカウントが表示されることを確認
# 3. テスター情報 (メールアドレス、パスワード) を記録

# IAP製品のメタデータ確認:
# - 表示名が日本語になっている
# - 説明文が適切に設定されている
# - 価格が正しい (¥1,980, ¥980)
# - スクリーンショットがアップロード済み (プレースホルダー可)

# 後続タスクT302で実際にテスト購入を行う
```

## トラブルシューティング

### 問題: Apple Developer Program登録が承認されない

**症状**: 48時間経過しても承認メールが届かない

**解決策**:
```
1. 登録メールアドレスのスパムフォルダを確認
2. Apple Developer Support に問い合わせ
   https://developer.apple.com/contact/
3. 電話番号が正しいか確認 (SMS認証が必要)
4. 支払いが完了しているか確認 (クレジットカード明細)
```

### 問題: バンドルIDが既に使用されている

**症状**: `com.bananadish.app` が登録できない

**解決策**:
```
1. バンドルIDは一意である必要がある
2. 別のバンドルIDを使用:
   - com.yourdomain.bananadish
   - com.bananadish.app.v2
3. XcodeプロジェクトのバンドルIDも同じものに変更
4. app.json の "bundleIdentifier" を更新
```

### 問題: IAP製品が「準備完了」にならない

**症状**: 製品のステータスが「メタデータが不足しています」

**解決策**:
```
必須項目確認:
- [ ] 参照名が入力されている
- [ ] 製品IDが入力されている (一度作成したら変更不可)
- [ ] 価格が設定されている
- [ ] ローカリゼーション (日本語) が設定されている
- [ ] 表示名が入力されている
- [ ] 説明文が入力されている
- [ ] レビュー情報 (スクリーンショット) がアップロードされている

スクリーンショットがない場合:
- プレースホルダー画像でOK (後で差し替え可能)
- 最低1枚必要
```

### 問題: Sandbox テスターでサインインできない

**症状**: iOS設定でSandboxアカウントにサインインできない

**解決策**:
```
重要: Sandbox アカウントは本番のApple IDとは別物

1. iOSデバイスの設定を確認:
   設定 > App Store > Sandbox アカウント
   (本番のApple IDからサインアウトする必要はない)

2. Sandboxアカウントは初回IAP購入時にサインイン
   (事前にサインインする必要はない)

3. テストフライトビルドまたはXcodeから直接実行したビルドでのみ動作
   (App Storeからダウンロードしたアプリでは使用不可)
```

### 問題: 年会費が支払えない

**症状**: クレジットカードエラーで年会費が支払えない

**解決策**:
```
1. 対応カード確認:
   - Visa, Mastercard, JCB, American Express
   - デビットカードも使用可能

2. カード情報確認:
   - カード番号が正しいか
   - 有効期限が切れていないか
   - セキュリティコード (CVV) が正しいか
   - 利用可能残高があるか

3. 別のカードを試す

4. Apple Developer Support に問い合わせ
```

### 問題: サブスクリプション価格が設定できない

**症状**: ¥1,980 が選択肢にない

**解決策**:
```
1. App Store の価格帯 (Tier) を使用:
   - Tier 20 = ¥1,980 (2026年1月時点)
   - 価格は時期により変動する可能性あり

2. 最も近い価格帯を選択:
   - Tier 19 = ¥1,840
   - Tier 20 = ¥1,980
   - Tier 21 = ¥2,120

3. カスタム価格設定 (Base Country Pricing):
   - 「日本」を基本国として設定
   - ¥1,980 を手動入力
   - 他の国の価格は自動計算される
```

## Deliverables

- Apple Developer Program メンバーシップ (有効期限1年)
- App Store Connect 登録アプリ: BananaDish
- IAP製品2つ:
  - `com.bananadish.starter.monthly` (¥1,980/月)
  - `com.bananadish.addon.10gen` (¥980)
- Sandbox テスターアカウント 3つ
- プレースホルダースクリーンショット

## Notes

- **年間費用**: Apple Developer Program は ¥12,800/年 (自動更新)
- **製品ID不変**: 一度作成した製品IDは変更できないため、慎重に命名
- **Sandbox環境**: 本番購入はされないため、テストは安全
- **スクリーンショット**: プレースホルダーでOK、T403で実際の画面に差し替え
- **税務情報**: 収益化時に必須、事前に準備しておくとスムーズ
- **価格変更**: App Store Connect でいつでも変更可能 (審査不要)

## 関連ドキュメント

- [Apple Developer Program 公式ガイド](https://developer.apple.com/programs/)
- [App Store Connect ヘルプ](https://help.apple.com/app-store-connect/)
- [In-App Purchase ガイド](https://developer.apple.com/in-app-purchase/)
- [実装計画書 - T301](/home/noritakasawada/project/20260117/docs/plans/bananadish-workplan.md#t301-apple-developer--app-store-connect-setup)
